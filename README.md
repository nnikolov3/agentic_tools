# Multi‑Agent‑MCP  

**Agentic toolchain for architecting, designing, validating, and approving code via chained LLM agents.**  

[GitHub repository](https://github.com/nnikolov3/multi-agent-mcp.git)  

---  

## Table of Contents  

1. [Key Features](#key-features)  
2. [Prerequisites](#prerequisites)  
3. [Installation](#installation)  
4. [Configuration](#configuration)  
5. [Usage](#usage)  
6. [Project Structure](#project-structure)  
7. [Contributing](#contributing)  
8. [License](#license)  

---  

## Key Features  

| Feature                       | Description                                                                                                                          |
|-------------------------------|--------------------------------------------------------------------------------------------------------------------------------------|
| **Multi‑agent pipeline**      | Separate agents for architecture, design, development, debugging, validation, triage, documentation, and final approval.             |
| **Declarative configuration** | All agents, prompts, models, and policies live in a single `conf/mcp.toml` file.                                                     |
| **Context‑aware execution**   | Recent source changes and design documents are automatically assembled and fed to each agent.                                        |
| **Model‑agnostic**            | Supports any LLM provider (Google, Groq, Cerebras, SambaNova, etc.) – the configuration chooses the preferred provider and fallback. |
| **Strict quality gates**      | The `approver` agent returns a JSON decision (`APPROVED` or `CHANGES_REQUESTED`) before any commit is made.                          |
| **Extensible**                | Adding a new agent only requires a TOML section and a Python class that inherits from `BaseAgent`.                                   |
| **Test‑driven**               | A full test suite (`tests/`) ensures >80 % coverage and runs on every change.                                                        |
| **Automated linting**         | `.mega-linter.yml` together with `ruff`, `black`, and `mypy` enforce zero‑warning code.                                              |

---  

## Prerequisites  

| Requirement                                                                       | Reason                                                                                                                          |
|-----------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------|
| **Python 3.11+**                                                                  | The code uses `from __future__ import annotations` and type‑hinted APIs that require recent Python.                             |
| **uv (optional)**                                                                 | Fast, reproducible Python package manager used by the project (`uv.lock` is present).                                           |
| **Git**                                                                           | The tool inspects the repository to collect recent source files and to enforce the final approval step.                         |
| **Access to at least one LLM provider** (e.g., Google, Groq, Cerebras, SambaNova) | Agents call the provider defined in `conf/mcp.toml`. API keys must be supplied via environment variables (see *Configuration*). |

> **Note** – No system‑level package manager (e.g., `apt-get`) is required; all dependencies are pure‑Python.

---  

## Installation  

```bash
# 1️⃣ Clone the repository
git clone https://github.com/nnikolov3/multi-agent-mcp.git
cd multi-agent-mcp

# 2️⃣ Install Python dependencies
# Using uv (recommended)
uv sync   # creates a virtual environment and installs from uv.lock

# Or with pip
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt   # (generated by `uv pip compile` if needed)
```

> The project ships a `pyproject.toml`‑compatible lock file (`uv.lock`).  
> If you prefer `poetry` or `pipenv`, you can generate a lock file from `requirements.txt` after the first install.

---  

## Configuration  

All runtime settings are stored in **`conf/mcp.toml`**. The most important sections are:

```toml
[multi-agent-mcp]
project_name = "Multi-Agent-MCP"
project_description = "Agentic toolchain for architecting, designing, validating, and approving code via chained tools."

# ── Inference providers (global priority order)
[multi-agent-mcp.inference_providers]
providers = ["google", "groq", "cerebras", "sambanova"]
```

### Agent definitions  

Each agent has its own table (`[multi-agent-mcp.<agent_name>]`) containing:

| Field                       | Meaning                                                  |
|-----------------------------|----------------------------------------------------------|
| `prompt`                    | System prompt fed to the LLM.                            |
| `model_name`                | Name of the model to use (e.g., `qwen-3-235b Instruct`). |
| `temperature`               | Sampling temperature (0 = deterministic).                |
| `model_providers`           | Preferred providers for this agent.                      |
| `skills`                    | Human‑readable list of skills the agent should expose.   |
| `description`               | Short human description (used by the README writer).     |
| `project_root` *(optional)* | Overrides the default working directory.                 |

### Context‑assembly policy  

```toml
# How recent files are collected for every agent
recent_minutes = 10
src_dir = "src"
include_extensions = [".py", ".rs", ".go", ".ts", ".tsx", ".js", ".json", ".md", ".toml", ".yml", ".yaml"]
exclude_dirs = [".git", ".github", "node_modules", "venv", "__pycache__"]
max_file_bytes = 262144          # 256 KB per file
max_total_bytes = 1048576        # 1 MB total payload
```

### Environment variables  

| Variable            | Example    | Description                      |
|---------------------|------------|----------------------------------|
| `GOOGLE_API_KEY`    | `abcd1234` | API key for the Google provider. |
| `GROQ_API_KEY`      | `xyz987`   | API key for the Groq provider.   |
| `CEREBRAS_API_KEY`  | `...`      | API key for Cerebras.            |
| `SAMBANOVA_API_KEY` | `...`      | API key for SambaNova.           |

> The `Configurator` class reads the TOML file and injects these values at runtime.

---  

## Usage  
The entry point is **`main.py`**. It loads the configuration, builds the agent pipeline, and executes the requested agent.

```bash
# Show available agents
python main.py --list

# Run a specific agent (e.g., the README writer)
python main.py --agent readme_writer

# Run the full pipeline (architect → designer → developer → … → approver)
python main.py --run-all
```

### Example: Generating a README  

```bash
python main.py --agent readme_writer
```

The tool will:

1. Load design docs (`DESIGN_PRINCIPLES_GUIDE.md`, `CODING_FOR_LLMs.md`).  
2. Collect recent source files from `src/`.  
3. Assemble project‑structure information (`tree -L 3`).  
4. Call the LLM with a system prompt that includes the agent’s `skills`.  
5. Return a JSON payload whose `data.readme_content` field contains the generated `README.md`.  

You can pipe the output to a file:

```bash
python main.py --agent readme_writer | jq -r '.data.readme_content' > README.generated.md
```

### Example: Final approval  

```bash
python main.py --agent approver
```

The `approver` agent returns a strict JSON object, e.g.:

```json
{
  "decision": "APPROVED",
  "summary": "All checks passed; code conforms to design principles.",
  "positive_points": ["Clear architecture", "All tests pass", "No lint warnings"],
  "negative_points": [],
  "required_actions": []
}
```

If the decision is `CHANGES_REQUESTED`, the `required_actions` array lists concrete steps for the developer.

---  

## Project Structure  

```
multi-agent-mcp/
├── conf/
│   └── mcp.toml               # Central configuration (agents, policies, etc.)
├── docs/
│   ├── AGENTIC_TOOLS_BEST_PRACTICES.md
│   ├── CODING_FOR_LLMs.md
│   ├── DESIGN_PRINCIPLES_GUIDE.md
│   ├── FASTMCP.md
│   ├── PROMPT_ENGINEERING.md
│   └── PROVIDERS_SDK.md
├── src/
│   ├── __init__.py
│   ├── _api.py               # Thin wrapper around LLM provider SDKs
│   ├── approver.py           # Final gate‑keeper agent
│   ├── base_agent.py         # Shared functionality for all agents
│   ├── configurator.py       # Loads TOML, builds ContextPolicy objects
│   ├── prompt_utils.py       # Helpers for serialising LLM responses
│   ├── readme_writer_tool.py # README‑generation agent (the one you are reading)
│   └── shell_tools.py        # Git info, project‑tree, recent‑source collector
├── tests/
│   ├── test_api.py
│   ├── test_approver.py
│   ├── test_configurator.py
│   ├── test_google_integration.py
│   ├── test_prompt_utils.py
│   └── test_readme_writer_tool.py
├── .env                       # Local environment (API keys, etc.)
├── .mega-linter.yml           # Mega‑Linter configuration (zero‑warning policy)
├── AGENTS.md                  # High‑level description of each agent
├── main.py                    # CLI entry point
├── mcp.log                    # Runtime log (JSON‑structured)
├── mypy.ini                   # mypy strict configuration
├── README.md                  # This file
└── uv.lock                    # uv lock file (pinned dependencies)
```

*Only the `src/` package contains executable code; everything else is documentation, configuration, or tooling.*

---  

## Contributing  

1. **Fork the repository** and create a feature branch (`git checkout -b feature/your‑idea`).  
2. **Write tests** before changing code (TDD). All new code must keep overall test coverage ≥ 80 %.  
3. **Run the full quality suite**  

   ```bash
   # Lint & format
   ruff check .
   black --check .
   # Type checking
   mypy .
   # Mega‑Linter (CI‑compatible)
   mega-linter-runner
   # Tests
   pytest -q
   ```

4. **Commit atomically** – each commit should represent a single logical change and include a clear message.  
5. **Open a Pull Request** targeting `main`. The CI pipeline will automatically run the linter, type‑checker, and test suite.  
6. **Approval** – the `approver` agent must return `APPROVED` before the PR can be merged.  

*All contributions must respect the **Foundational Design Principles** (simplicity, explicitness, single responsibility, acyclic dependencies, etc.) located in `docs/DESIGN_PRINCIPLES_GUIDE.md`.*

---  

## License  
The repository does **not** currently include a license file.  
If you intend to use or redistribute this code, add an appropriate open‑source license (e.g., MIT, Apache 2.0, or GPL) to the root of the project and update this section accordingly.  

---  

*Generated by the built‑in **README Writer** agent (see `src/readme_writer_tool.py`).*
